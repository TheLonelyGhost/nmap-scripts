#!/usr/bin/env bash

set -euo pipefail

# Find the interfaces that have private IP addresses assigned:
# - 192.168.x.x
# - 10.x.x.x
# - 172.16.x.x to 172.31.x.x

get-physical-ifaces() {
  local iface
  iface=""

  for nm in /sys/class/net/*; do
    if readlink "$nm" | grep -qv 'virtual' &>/dev/null; then
      iface="$(basename -- "$nm")"
      # ip -4 -o address show dev "$iface" | awk '{ split($4, 
      printf '%s\n' "$iface"
    fi
  done
}

# shellcheck disable=2016
awk_printer='$2 " " a[1]'

if [ $# -gt 0 ]; then
  case "$1" in
    ip*|-q|--quiet)
      awk_printer='a[1]'
      ;;
    iface|interface)
      # shellcheck disable=2016
      awk_printer='$2'
      ;;
  esac
fi

get-physical-ifaces | xargs -I{} ip -4 -o address show dev '{}' | awk '{ split($4, a, "/"); print '"${awk_printer}"' }'
